{"version":3,"sources":["day8/re_frame_10x/fx/local_storage.cljs"],"mappings":";;;;AASA;;;;;AAAKA,uDAIH,iBAAA,AACE,oBAAME;AAAN,AACE,YAAAC;;AADF;;gBADF,GAAA,CAAAF,kBAGSG;AAHT,QAAAH,JAGkBI;AAHlB,AAII,YAAAC;;AAJJ,AAAA,MAAAL;;;;AAMF,AAAKM,6CAAQ,KAAAC,qBAAuBR;AAEpC,iDAAA,jDAAKS;AAEL;;;8CAAA,9CAAOC,oGAEJC;AAFH,AAGE,QAAKF,2FAAYE;;AAEnB,AAAA;;;0CAAA,kDAAAC,5FAAME;AAAN,AAAA,IAAAD,WAAA,AAAA;AAAA,AAAA,QAAAA;KAAA;AAAA,OAAAC,sEAAA,CAAA,UAAA;;;KAAA;AAAA,OAAAA,sEAAA,CAAA,UAAA,MAAA,CAAA,UAAA;;;;AAAA,MAAA,KAAAV,MAAA,CAAA,8DAAA,AAAA;;;;;AAAA,CAAA,wEAAA,xEAAMU,mFAEFH;AAFJ,AAGG,iFAAA,1EAACI,sEAAKJ;;;AAHT,CAAA,wEAAA,xEAAMG,mFAIFH,IAAIK;AAJR,AAKG,IAAMC,QAAM,AAAMV,+CAAQ,AAACG,4CAASC;AAApC,AACE,GAAI,YAAYM;AACdD;;AACA,OAACE,sDAAmBD;;;;AAR3B,CAAA,kEAAA,lEAAMH;;AAAN,AAUA,8CAAA,9CAAOK;AAAP,AACE,IAAA,AACE,OAACE,YAAenB;gBADlB,GAAA,CAAAkB,kBAEShB;AAFT,QAAAgB,JAEkBf;AAFlB,AAAA;;AAAA,AAAA,MAAAe;;;;AAKF;;;2DAAA,3DAAME;AAAN,AAGE,IAAAC,aAAA,AAAAC,cAAU,AAACL;IAAXM,eAAA;IAAAC,eAAA;IAAAC,WAAA;;AAAA,AAAA,GAAA,AAAA,CAAAA,WAAAD;AAAA,QAAA,AAAAD,kDAAAE,tDAAQS;AAAR,AAAA,AACE,GAAM,AAACC,kCAAoBD,EAAE3B;AAA7B,AACE,AAASF,kDAAQ6B;;AADnB;;AADF;AAAA,eAAAb;eAAAE;eAAAC;eAAA,CAAAC,WAAA;;;;;;;AAAA,IAAAC,qBAAA,AAAAJ,cAAAD;AAAA,AAAA,GAAAK;AAAA,AAAA,IAAAL,iBAAAK;AAAA,AAAA,GAAA,AAAAC,6BAAAN;AAAA,IAAAO,kBAAA,AAAAC,sBAAAR;AAAA,AAAA,eAAA,AAAAS,qBAAAT;eAAAO;eAAA,AAAAG,gBAAAH;eAAA;;;;;;;AAAA,QAAA,AAAAI,gBAAAX,pBAAQa;AAAR,AAAA,AACE,GAAM,AAACC,kCAAoBD,EAAE3B;AAA7B,AACE,AAASF,kDAAQ6B;;AADnB;;AADF;AAAA,eAAA,AAAAD,eAAAZ;eAAA;eAAA;eAAA;;;;;;;;AAAA;;;;;;AAIF,AAAA,0CAAA,kDAAAX,5FAAM2B;AAAN,AAAA,IAAAD,WAAA,AAAA;AAAA,AAAA,QAAAA;KAAA;AAAA,OAAAC,sEAAA,CAAA,UAAA;;;;AAAA,IAAAC,yBAAA;AAAA,AAAA,IAAAC,0BAAA,AAAA;AAAA,AAAA,IAAAC,wBAAA;;AAAA,AAAA,GAAA,CAAAA,wBAAAD;AAAA,AAAA,AAAAD,4BAAA,CAAA,UAAAE;;AAAA,eAAA,CAAAA,wBAAA;;;;AAAA;;;;AAAA,IAAAC,uBAAA,KAAAC,qBAAA,AAAAJ,6BAAA,KAAA,IAAA;AAAA,AAAA,OAAAD,6EAAA,CAAA,UAAA,MAAAI;;;;;AAAA,CAAA,wEAAA,xEAAMJ,mFACF5B;AADJ,AAEG,OAACqC,mEACC,WAAKC;AAAL,AACE,OAAM1C,+CAAQ,AAACG,4CAASC,KAAK,AAACuC,wGAAOD;;;;AAJ5C,AAAA,CAAA,+EAAA,/EAAMV,0FAKF5B,IAAMwC;AALV,AAMG,OAACH,mEACC,WAAKC;AAAL,AACE,OAACG,oBACC,WAAKhB;AAAL,AACE,IAAMiB,IAAE,EAAI,AAACC,wBAAQlB,IAAG,AAACmB,+CAAON,GAAGb,GAAG,AAACoB,4CAAIP,GAAGb;AAA9C,AACE,OAAM7B,+CAAQ,AAACG,4CAASC,KAAK,AAACuC,wGAAOG;GACzCF;;;;AAZT;AAAA,CAAA,4DAAA,WAAAN,vEAAMN;AAAN,AAAA,IAAAO,WAAA,AAAAZ,gBAAAW;IAAAA,eAAA,AAAAV,eAAAU;AAAA,AAAA,IAAAE,qBAAA;AAAA,AAAA,OAAAA,wDAAAD,SAAAD;;;AAAA,CAAA,kEAAA,lEAAMN;;AAAN,AAcA,sEAAA,tEAACkB,8LAEC,qBAAAC,VAAKG;AAAL,AAAA,IAAAF,aAAAD;IAAAC,iBAAA,AAAAC,4BAAAD;UAAA,AAAAH,4CAAAG,eAAA,jEAAuBhD;SAAvB,AAAA6C,4CAAAG,eAAA,hEAA2BG;AAA3B,AACE,OAACC,8CAAMF,UACL,AAACG,gDAAQrD,KACT,AAACI,sEAAKJ,IAAImD","names":["day8.re-frame-10x.fx.local-storage/storage-mechanism","e20162","js/localStorage","js/goog.storage.mechanism.HTML5LocalStorage","js/Error","_","day8.re_frame_10x.fx.local_storage.goog$module$goog$testing$storage$FakeMechanism","day8.re-frame-10x.fx.local-storage/storage","js/goog.storage.Storage","day8.re-frame-10x.fx.local-storage/safe-prefix","day8.re-frame-10x.fx.local-storage/safe-key","key","var_args","G__20171","day8.re-frame-10x.fx.local-storage/load","day8.re_frame_10x.fx.local_storage.load","not-found","value","cljs.reader.read_string","day8.re-frame-10x.fx.local-storage/all-keys","e20181","js/Object.keys","day8.re-frame-10x.fx.local-storage/delete-all-keys!","seq__20182","cljs.core/seq","chunk__20183","count__20184","i__20185","temp__5804__auto__","cljs.core/chunked-seq?","c__5565__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","cljs.core/first","cljs.core/next","k","clojure.string/starts-with?","G__20200","day8.re-frame-10x.fx.local-storage/save","args-arr__5791__auto__","len__5766__auto__","i__5767__auto__","argseq__5792__auto__","cljs.core/IndexedSeq","seq20198","G__20199","self__5751__auto__","day8.re-frame-10x.inlined-deps.re-frame.v1v1v2.re-frame.core/after","db","cljs.core.pr_str","ks","cljs.core/run!","v","cljs.core/vector?","cljs.core.get_in","cljs.core.get","day8.re-frame-10x.inlined-deps.re-frame.v1v1v2.re-frame.core/reg-cofx","p__20205","map__20206","cljs.core/--destructure-map","coeffects","or","cljs.core.assoc","cljs.core.keyword"],"sourcesContent":["(ns day8.re-frame-10x.fx.local-storage\n  (:require\n    [goog.storage.Storage]\n    [goog.storage.mechanism.HTML5LocalStorage]\n    [goog.testing.storage.FakeMechanism]\n    [cljs.reader                                                  :as reader]\n    [clojure.string                                               :as string]\n    [day8.re-frame-10x.inlined-deps.re-frame.v1v1v2.re-frame.core :as rf]))\n\n(def storage-mechanism\n  \"LocalStorage is not available in sandboxed iframes, so check\n  window.localStorage and use the fake storage mechanism if it's not available.\n  re-frame-10x settings will not persist, but it will work.\"\n  (try\n    (when js/localStorage\n      (goog.storage.mechanism.HTML5LocalStorage.))\n    (catch js/Error _\n      (goog.testing.storage.FakeMechanism.))))\n\n(def storage (goog.storage.Storage. storage-mechanism))\n\n(def safe-prefix \"day8.re-frame-10x.\")\n\n(defn- safe-key\n  \"Adds a unique prefix to local storage keys to ensure they don't collide with the host application\"\n  [key]\n  (str safe-prefix key))\n\n(defn load\n  \"Loads a re-frame-10x value from local storage.\"\n  ([key]\n   (load key nil))\n  ([key not-found]\n   (let [value (.get storage (safe-key key))]\n     (if (undefined? value)\n       not-found\n       (reader/read-string value)))))\n\n(defn- all-keys []\n  (try\n    (js/Object.keys js/localStorage)\n    (catch js/Error _\n      [])))\n\n(defn delete-all-keys!\n  \"Deletes all re-frame-10x config keys\"\n  []\n  (doseq [k (all-keys)]\n    (when (string/starts-with? k safe-prefix)\n      (.remove storage k))))\n\n(defn save\n  ([key]\n   (rf/after\n     (fn [db]\n       (.set storage (safe-key key) (pr-str db)))))\n  ([key & ks]\n   (rf/after\n     (fn [db]\n       (run!\n         (fn [k]\n           (let [v (if (vector? k) (get-in db k) (get db k))]\n             (.set storage (safe-key key) (pr-str v))))\n         ks)))))\n\n(rf/reg-cofx\n  ::load\n  (fn [coeffects {:keys [key or]}]\n    (assoc coeffects\n      (keyword key)\n      (load key or))))\n"]}